<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="LLG.Views.SessionDetailPage"
             Title="Séance"
>

    <ScrollView>
        <ScrollView.Background>
            <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                <GradientStop Color="Black" Offset="0.15" />
                <GradientStop Color="#42A5F5" Offset="1.0" />
            </LinearGradientBrush>
        </ScrollView.Background>


        <VerticalStackLayout Spacing="15" Padding="20">

            <Label Text="Infos Séance" TextColor="White" FontSize="18" FontAttributes="Bold"/>
            <Label Text="Nom de la séance" TextColor="#009688"/>
            <Entry Text="{Binding CurrentSession.Name}" Placeholder="ex: Benmoon" TextColor="White"/>
            <Entry Text="{Binding CurrentSession.LocationName}" Placeholder="Lieu (ex: Arkose)" TextColor="White" PlaceholderColor="Gray"/>
                    


            <Grid ColumnDefinitions="*,*">
                <Entry Grid.Column="0" 
                        Text="{Binding CurrentSession.DurationMinutes}" 
                        Keyboard="Numeric" TextColor="White"/>
                <Label Grid.Column="1" Text="minutes" VerticalOptions="Center" TextColor="Gray"/>
            </Grid>

            <Label Text="État de forme" TextColor="{StaticResource AccentYellow}" FontSize="14" Margin="0,5,0,0"/>
            <Grid ColumnDefinitions="*,*" ColumnSpacing="20">
                <VerticalStackLayout Grid.Column="0">
                    <Label Text="Début" TextColor="Gray" FontSize="10" HorizontalOptions="Center"/>
                    <Slider x:Name="SliderBegin" Minimum="0" Maximum="10" 
                            Value="{Binding CurrentSession.InitialMood}" 
                            MinimumTrackColor="{StaticResource AccentYellow}" ThumbColor="White"/>
                    <Label Text="{Binding Source={x:Reference SliderBegin}, Path=Value, StringFormat='{0:F0}'}" TextColor="White" HorizontalOptions="Center"/>
                </VerticalStackLayout>

                <VerticalStackLayout Grid.Column="1">
                    <Label Text="Fin" TextColor="Gray" FontSize="10" HorizontalOptions="Center"/>
                    <Slider x:Name="SliderEnd" Minimum="0" Maximum="10" 
                            Value="{Binding CurrentSession.FinalMood}" 
                            MinimumTrackColor="{StaticResource AccentRed}" ThumbColor="White"/>
                    <Label Text="{Binding Source={x:Reference SliderEnd}, Path=Value, StringFormat='{0:F0}'}" TextColor="White" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </Grid>

            <Label Text="Notes de séance" TextColor="{StaticResource PrimaryTeal}" FontSize="12"/>
            <Editor Text="{Binding CurrentSession.Notes}" 
                    Placeholder="Commentaire général..." 
                    HeightRequest="60" 
                    TextColor="White" 
                    PlaceholderColor="Gray" 
                    BackgroundColor="{StaticResource CardBackground}"/>

            <Grid ColumnDefinitions="*, Auto" Margin="0,10,0,5">
                <Label Text="Voies / Blocs" TextColor="{StaticResource AccentYellow}" FontSize="16" FontAttributes="Bold" VerticalOptions="Center"/>
                <Button Grid.Column="1" Text="+ Ajouter Voie" Clicked="OnAddRouteClicked" FontSize="12" HeightRequest="35" BackgroundColor="#333" TextColor="White"/>
            </Grid>

            <StackLayout BindableLayout.ItemsSource="{Binding TemporaryRoutes}" Spacing="10">
                <BindableLayout.ItemTemplate>
                    <DataTemplate>
                        <Border StrokeShape="RoundRectangle 5" BackgroundColor="#2A2A2A" Padding="10">
                            <Grid ColumnDefinitions="*, Auto, Auto, Auto">
                                <Grid.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnRouteSelected" CommandParameter="{Binding .}"/>
                                </Grid.GestureRecognizers>

                                <VerticalStackLayout Grid.Column="0" VerticalOptions="Center">
                                    <Label Text="{Binding Name}" TextColor="White" FontAttributes="Bold"/>
                                    <Label Text="{Binding Style}" TextColor="Gray" FontSize="10"/>
                                </VerticalStackLayout>

                                <Label 
                                    Grid.Column="1" 
                                    Text="{Binding Grade}" 
                                    FontAttributes="Bold" 
                                    VerticalOptions="Center" 
                                    Margin="10,0">
                                    <Label.Triggers>
                                        <DataTrigger TargetType="Label" Binding="{Binding IsSuccessful}" Value="True">
                                            <Setter Property="TextColor" Value="#00E676" />
                                        </DataTrigger>
                                        <DataTrigger TargetType="Label" Binding="{Binding IsSuccessful}" Value="False">
                                            <Setter Property="TextColor" Value="{StaticResource AccentYellow}" />
                                        </DataTrigger>
                                    </Label.Triggers>
                                </Label>

                                <Button Grid.Column="3" Text="X" TextColor="White" BackgroundColor="DarkRed" 
                                        FontSize="12" WidthRequest="40" HeightRequest="40" CornerRadius="20"
                                        Clicked="OnDeleteRouteClicked" CommandParameter="{Binding .}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </BindableLayout.ItemTemplate>
            </StackLayout>

            <Grid ColumnDefinitions="*,*" ColumnSpacing="15" Margin="0,20,0,50">
                <Button Grid.Column="0" Text="Supprimer" Clicked="OnDeleteSessionClicked" BackgroundColor="DarkRed" TextColor="White"/>
                <Button Grid.Column="1" Text="Enregistrer" Clicked="OnSaveSessionClicked" BackgroundColor="{StaticResource PrimaryTeal}" TextColor="White" FontAttributes="Bold"/>
            </Grid>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>